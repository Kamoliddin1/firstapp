{#{% extends 'basicapp/base.html' %}#}
{#{% block aside %}#}
<div class="col-md-4">
    <div class="content-section">
        <h3>Archive Section</h3>
        <p class='text-muted'>You can see your old results.</p>
        <div id="js-archive-ajax">
            <ul class="list-group">
                {% for result in latest %}
                    <button class="btn btn-link" type="button" data-toggle="collapse"
                            data-target="#{{ result.id }}">{{ result.created_at|date:"F j, Y P" }}</button>
                    <li class="collapse" id="{{ result.id }}">
                        {% for res in result.answers.all %}
                            <div class="card card-body custom-body">
                                <small><p>{{ res.question.word }}</p></small>
                                <em class="{% if res.choice != res.question.word %}text-danger{% else %}text-success{% endif %}">{{ res.choice }}</em>
                            </div>
                        {% endfor %}
                    </li>
                {% endfor %}
            </ul>
        </div>
        <ul class="pagination pagination-sm">
            <div class="step-links">
                {% if page_obj.has_previous %}
                    <li class="page_item">
                        <a id="prev" class="page-link" href="?page=1">First</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ page_obj.previous_page_number }}">&laquo;</a>
                    </li>
                {% endif %}

                <span class="current_page">{{ paginator.number }}</span>

                {% if page_obj.has_next %}
                    <li class="page-item">
                        <a id="next" class="page-link" href="?page={{ page_obj.next_page_number }}">&raquo;</a>
                    </li>

                {% endif %}
            </div>
        </ul>
    </div>
</div>
{#{% endblock %}#}

{% block javascript %}
    <script type="text/javascript">
        function ajax_get_update() {
            $.get(url, function (results) {
                //get the parts of the result you want to update. Just select the needed parts of the response
                var table = $("ul.list-group", results);
                var span = $("ul.pagination", results);

                //update the ajax_table_result with the return value
                $('#js-archive-ajax').html(table);
                $('.step-links').html(span);
            }, "html");
        }

        //bind the corresponding links in your document to the ajax get function
        $(document).ready(function () {
            $('.step-links #prev').click(function (e) {
                e.preventDefault();
                url = ($('.step-links #prev')[0].href);
                ajax_get_update();
            });
            $('.step-links #next').click(function (e) {
                e.preventDefault();
                url = ($('.step-links #next')[0].href);
                ajax_get_update();

            });
        });

        //since the links are reloaded we have to bind the links again
        //to the actions
        $(document).ajaxStop(function () {
            $('.step-links #prev').click(function (e) {
                e.preventDefault();
                url = ($('.step-links #prev')[0].href);
                ajax_get_update();
            });
            $('.step-links #next').click(function (e) {
                e.preventDefault();
                url = ($('.step-links #next')[0].href);
                ajax_get_update();
            });
        });
    </script>
{% endblock %}
